# YBB Tally Bot - AI Assistant Rules

Follow these rules strictly when working on this project. These combine local setup requirements, testing protocols, and the new feature flag system.

## 1. Local Setup & Environment
- **Environment Variables:** Always check if new features require new environment variables. Remind the user to add them to their local `.env` file.
- **Prisma:** If the database schema (`prisma/schema.prisma`) is modified, remind the user to run:
  - `npm run prisma:generate`
  - `npm run prisma:migrate`
- **Dependencies:** If new packages are added, remind the user to run `npm install`.

## 2. Development & Testing Protocol
- **Build Check:** Before finishing any task, suggest running `npm run build` to ensure TypeScript compilation passes.
- **Manual Testing:** After implementing a feature, prompt the user to test it locally using `npm run dev`.
- **Timezone:** Always remember that this bot operates in `Asia/Singapore` timezone. Use `date-fns-tz` for all date operations.

## 3. Feature Flag Protocol
- **Clash Detection (CRITICAL):** Whenever a requested feature is "somewhat similar" to an existing one or would overlap/replace its functionality, you MUST NOT proceed immediately.
- **User Consultation:** Use the `ask_question` tool to consult the user:
    - Should the old flow be disabled?
    - Should the new feature be enabled by default?
    - Should a new feature flag be created to toggle between them?
- **Implementation:** Wrap all clashing features in a flag from `src/config.ts`:
  ```typescript
  if (CONFIG.FEATURE_FLAGS.ENABLE_NEW_FEATURE) {
    // New implementation
  } else {
    // Original implementation
  }
  ```

## 4. Documentation
- Keep the `README.md` and `USER_GUIDE.md` updated if new commands or major features are added.
