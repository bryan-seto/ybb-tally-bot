# ðŸ§  META-INSTRUCTIONS
- **Model Preference:** Use 'auto' (standard) model context. Be concise, thorough, and code-focused.
- **Timezone:** Current context is `Asia/Singapore`. Use `date-fns-tz` for date operations.

# ðŸš¦ PHASE 1: THE PLAN ("Think First" Protocol)
**Trigger:** Before writing any code or when I ask for a feature.
**Action:** You MUST output a structured plan. Do not write code yet.

1. **The Context:** Briefly state the goal and "Why".
2. **File Strategy:** List files to create/modify.
3. **Test Strategy:**
   - *Rule:* Always add/update tests for logic changes.
   - *Rule:* If refactoring, ensure existing tests cover regressions.
4. **Docs Check:** (For later) Note if `USER_GUIDE.md` *will* need updates (but do not update it yet).

> **WAIT:** Stop here and wait for my "Go" or confirmation.

# ðŸ§ª PHASE 2: EXECUTION & LOCAL TDD
**Trigger:** After I approve the plan.
**Action:**

1. **Test First:** If new logic is needed, write the Unit Test file *first*.
2. **Implement:** Write the feature code.
3. **Verify:** ALWAYS output the terminal command to run the specific test (e.g., `npm test src/path/to/test.ts`).
   - *Constraint:* Do not assume success. Ask me to run it.

# ðŸ•µï¸ PHASE 3: STAGING DEPLOYMENT
**Trigger:** When I say "Push to Staging" or "Ship to Staging".
**Action:**

1. **Git Sequence:** Output this exact block:
   ```bash
   git add .
   git commit -m "feat: [Concise Description]"
   git push origin staging

```

2. **Verification Prompt:** Immediately output the Manual Verification Block:
> **ðŸ•µï¸ Staging Smoke Tests (Step-by-Step):**


> 1. [Exact Step 1: e.g., "Send 'edit /15 20' to bot"]
> 2. [Exact Step 2: e.g., "Check Dashboard for $20 update"]
> 3. [Exact Step 3: e.g., "Try invalid ID '/999' - expect error"]
> 
> 


> Please manually verify this on the Telegram Staging Bot: https://web.telegram.org/k/#-3370162727



# ðŸš€ PHASE 4: PRODUCTION RELEASE

**Trigger:** When I say "Deploy to Prod" or "Release".
**Action:**

1. **Docs Update (Conditional):**
* **IF** `USER_GUIDE.md` was modified during the feature work, output: `git add USER_GUIDE.md && git commit -m "docs: Update User Guide"`
* **IF NOT**, skip this step (do not create empty commits).


2. **Git Sequence (One-Shot):** Output this exact block to sync Staging â†’ Prod:
```bash
# Merge Staging to Main (Prod)
git checkout main
git pull origin main
git merge staging
git push origin main

# Return to Staging
git checkout staging

```


3. **Final Report:**
"ðŸš€ Production Deploy Triggered. Render should now see the push to main. I have switched you back to the staging branch."

# ðŸš« STRICT GUIDELINES

* Never skip the "Phase 1: Plan" step. Even for small changes, think first.
* Never update `USER_GUIDE.md` in Staging. Only in Phase 4.
* Never use Regex for JSON parsing.
* Always include specific data/commands in the Staging Smoke Tests (e.g., don't say "Test edit", say "Type edit /15 50").
