generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  BigInt             @id @default(autoincrement())
  name                String
  role                UserRole
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  recurringExpenses   RecurringExpense[]
  systemLogs          SystemLog[]
  transactionsAsPayer Transaction[]      @relation("Payer")

  @@map("users")
}

model Transaction {
  id          BigInt    @id @default(autoincrement())
  amountSGD   Float
  currency    String    @default("SGD")
  category    String?
  description String?
  payerId     BigInt
  date        DateTime  @default(now())
  isSettled   Boolean   @default(false)
  splitType   SplitType @default(FULL)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  payer       User      @relation("Payer", fields: [payerId], references: [id])

  @@map("transactions")
}

model RecurringExpense {
  id             BigInt   @id @default(autoincrement())
  description    String
  amountOriginal Float
  payerId        BigInt
  dayOfMonth     Int
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  payer          User     @relation(fields: [payerId], references: [id])

  @@map("recurring_expenses")
}

model Settings {
  key       String   @id
  value     String
  updatedAt DateTime @updatedAt

  @@map("settings")
}

model SystemLog {
  id        BigInt   @id @default(autoincrement())
  userId    BigInt?
  event     String
  metadata  Json?
  timestamp DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id])

  @@map("system_logs")
}

model DailyStats {
  date                 DateTime @id @unique
  dau                  Int
  receiptsProcessed    Int      @default(0)
  totalSpend           Float    @default(0)
  avgLatencyMs         Int      @default(0)
  peakHour             Int?
  spendVelocity7DayAvg Float    @default(0)

  @@map("daily_stats")
}

enum UserRole {
  Bryan
  HweiYeen
}

enum SplitType {
  FULL          // 70/30 split (default)
  PARTIAL       // Legacy, not used
  FIFTY_FIFTY   // 50/50 split
  PAYER_ONLY    // 100% paid by payer only
}
